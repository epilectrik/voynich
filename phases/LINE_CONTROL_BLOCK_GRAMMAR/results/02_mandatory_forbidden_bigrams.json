{
  "test": "Mandatory/Forbidden Token-Level Bigrams",
  "test_id": "02",
  "phase": "LINE_CONTROL_BLOCK_GRAMMAR",
  "purpose": "Identify token-level bigrams significantly over/under-represented vs independence",
  "parameters": {
    "min_token_freq": 10,
    "mandatory_ratio_threshold": 5.0,
    "mandatory_min_obs": 5,
    "bonferroni_alpha": 0.001,
    "forbidden_min_expected": 5.0,
    "n_shuffles": 1000,
    "seed": 42
  },
  "summary": {
    "n_lines": 2420,
    "n_common_tokens": 334,
    "total_bigrams": 10061,
    "n_tests_bonferroni": 111556,
    "bonferroni_threshold": 8.964107712718275e-09
  },
  "mandatory": {
    "count": 26,
    "count_new_beyond_or_aiin": 25,
    "bigrams": [
      {
        "token_a": "r",
        "token_b": "ain",
        "observed": 5,
        "expected": 0.15,
        "ratio": 32.79,
        "chi2": 154.12,
        "p_value": 0.0,
        "role_a": "FREQUENT_OPERATOR",
        "role_b": "AUXILIARY",
        "class_a": 23,
        "class_b": 24,
        "same_role": false,
        "same_class": false
      },
      {
        "token_a": "sar",
        "token_b": "ain",
        "observed": 5,
        "expected": 0.21,
        "ratio": 23.68,
        "chi2": 108.63,
        "p_value": 0.0,
        "role_a": "AUXILIARY",
        "role_b": "AUXILIARY",
        "class_a": 24,
        "class_b": 24,
        "same_role": true,
        "same_class": true
      },
      {
        "token_a": "s",
        "token_b": "aiin",
        "observed": 18,
        "expected": 0.8,
        "ratio": 22.46,
        "chi2": 369.04,
        "p_value": 0.0,
        "role_a": "FREQUENT_OPERATOR",
        "role_b": "FREQUENT_OPERATOR",
        "class_a": 23,
        "class_b": 9,
        "same_role": true,
        "same_class": false
      },
      {
        "token_a": "or",
        "token_b": "aiiin",
        "observed": 8,
        "expected": 0.45,
        "ratio": 17.64,
        "chi2": 125.57,
        "p_value": 0.0,
        "role_a": "FREQUENT_OPERATOR",
        "role_b": "AUXILIARY",
        "class_a": 9,
        "class_b": 28,
        "same_role": false,
        "same_class": false
      },
      {
        "token_a": "ar",
        "token_b": "aiiin",
        "observed": 6,
        "expected": 0.44,
        "ratio": 13.63,
        "chi2": 70.24,
        "p_value": 0.0,
        "role_a": "FLOW_OPERATOR",
        "role_b": "AUXILIARY",
        "class_a": 7,
        "class_b": 28,
        "same_role": false,
        "same_class": false
      },
      {
        "token_a": "or",
        "token_b": "air",
        "observed": 7,
        "expected": 0.52,
        "ratio": 13.44,
        "chi2": 80.62,
        "p_value": 0.0,
        "role_a": "FREQUENT_OPERATOR",
        "role_b": "AUXILIARY",
        "class_a": 9,
        "class_b": 24,
        "same_role": false,
        "same_class": false
      },
      {
        "token_a": "sar",
        "token_b": "al",
        "observed": 6,
        "expected": 0.49,
        "ratio": 12.24,
        "chi2": 61.93,
        "p_value": 3.552713678800501e-15,
        "role_a": "AUXILIARY",
        "role_b": "FLOW_OPERATOR",
        "class_a": 24,
        "class_b": 7,
        "same_role": false,
        "same_class": false
      },
      {
        "token_a": "r",
        "token_b": "aiin",
        "observed": 7,
        "expected": 0.58,
        "ratio": 12.09,
        "chi2": 71.23,
        "p_value": 0.0,
        "role_a": "FREQUENT_OPERATOR",
        "role_b": "FREQUENT_OPERATOR",
        "class_a": 23,
        "class_b": 9,
        "same_role": true,
        "same_class": false
      },
      {
        "token_a": "ches",
        "token_b": "aiin",
        "observed": 6,
        "expected": 0.51,
        "ratio": 11.72,
        "chi2": 58.81,
        "p_value": 1.7319479184152442e-14,
        "role_a": "ENERGY_OPERATOR",
        "role_b": "FREQUENT_OPERATOR",
        "class_a": 35,
        "class_b": 9,
        "same_role": false,
        "same_class": false
      },
      {
        "token_a": "or",
        "token_b": "aiin",
        "observed": 42,
        "expected": 3.76,
        "ratio": 11.16,
        "chi2": 388.58,
        "p_value": 0.0,
        "role_a": "FREQUENT_OPERATOR",
        "role_b": "FREQUENT_OPERATOR",
        "class_a": 9,
        "class_b": 9,
        "same_role": true,
        "same_class": true
      },
      {
        "token_a": "dair",
        "token_b": "al",
        "observed": 5,
        "expected": 0.45,
        "ratio": 11.13,
        "chi2": 46.08,
        "p_value": 1.132793858715786e-11,
        "role_a": "FLOW_OPERATOR",
        "role_b": "FLOW_OPERATOR",
        "class_a": 30,
        "class_b": 7,
        "same_role": true,
        "same_class": false
      },
      {
        "token_a": "otaiin",
        "token_b": "otal",
        "observed": 6,
        "expected": 0.56,
        "ratio": 10.73,
        "chi2": 52.95,
        "p_value": 3.4228175849193576e-13,
        "role_a": "FREQUENT_OPERATOR",
        "role_b": "FREQUENT_OPERATOR",
        "class_a": 13,
        "class_b": 14,
        "same_role": true,
        "same_class": false
      },
      {
        "token_a": "char",
        "token_b": "aiin",
        "observed": 5,
        "expected": 0.49,
        "ratio": 10.21,
        "chi2": 41.53,
        "p_value": 1.1608847216848517e-10,
        "role_a": "ENERGY_OPERATOR",
        "role_b": "FREQUENT_OPERATOR",
        "class_a": 31,
        "class_b": 9,
        "same_role": false,
        "same_class": false
      },
      {
        "token_a": "qol",
        "token_b": "sheedy",
        "observed": 6,
        "expected": 0.63,
        "ratio": 9.54,
        "chi2": 45.87,
        "p_value": 1.2662426662757298e-11,
        "role_a": "ENERGY_OPERATOR",
        "role_b": "ENERGY_OPERATOR",
        "class_a": 32,
        "class_b": 34,
        "same_role": true,
        "same_class": false
      },
      {
        "token_a": "lor",
        "token_b": "aiin",
        "observed": 6,
        "expected": 0.65,
        "ratio": 9.29,
        "chi2": 44.4,
        "p_value": 2.6735391678300857e-11,
        "role_a": "AUXILIARY",
        "role_b": "FREQUENT_OPERATOR",
        "class_a": 24,
        "class_b": 9,
        "same_role": false,
        "same_class": false
      },
      {
        "token_a": "s",
        "token_b": "ar",
        "observed": 5,
        "expected": 0.58,
        "ratio": 8.63,
        "chi2": 33.71,
        "p_value": 6.403371943797254e-09,
        "role_a": "FREQUENT_OPERATOR",
        "role_b": "FLOW_OPERATOR",
        "class_a": 23,
        "class_b": 7,
        "same_role": false,
        "same_class": false
      },
      {
        "token_a": "ar",
        "token_b": "al",
        "observed": 18,
        "expected": 2.23,
        "ratio": 8.06,
        "chi2": 111.32,
        "p_value": 0.0,
        "role_a": "FLOW_OPERATOR",
        "role_b": "FLOW_OPERATOR",
        "class_a": 7,
        "class_b": 7,
        "same_role": true,
        "same_class": true
      },
      {
        "token_a": "qokar",
        "token_b": "okar",
        "observed": 6,
        "expected": 0.78,
        "ratio": 7.7,
        "chi2": 34.95,
        "p_value": 3.3749096850499427e-09,
        "role_a": "ENERGY_OPERATOR",
        "role_b": "FREQUENT_OPERATOR",
        "class_a": 32,
        "class_b": 14,
        "same_role": false,
        "same_class": false
      },
      {
        "token_a": "sar",
        "token_b": "aiin",
        "observed": 6,
        "expected": 0.8,
        "ratio": 7.49,
        "chi2": 33.72,
        "p_value": 6.375138972281036e-09,
        "role_a": "AUXILIARY",
        "role_b": "FREQUENT_OPERATOR",
        "class_a": 24,
        "class_b": 9,
        "same_role": false,
        "same_class": false
      },
      {
        "token_a": "sheedy",
        "token_b": "qokeedy",
        "observed": 9,
        "expected": 1.22,
        "ratio": 7.35,
        "chi2": 49.36,
        "p_value": 2.12851958281135e-12,
        "role_a": "ENERGY_OPERATOR",
        "role_b": "ENERGY_OPERATOR",
        "class_a": 34,
        "class_b": 33,
        "same_role": true,
        "same_class": false
      },
      {
        "token_a": "okaiin",
        "token_b": "chckhy",
        "observed": 7,
        "expected": 1.0,
        "ratio": 6.98,
        "chi2": 35.87,
        "p_value": 2.107652385952008e-09,
        "role_a": "FREQUENT_OPERATOR",
        "role_b": "ENERGY_OPERATOR",
        "class_a": 13,
        "class_b": 34,
        "same_role": false,
        "same_class": false
      },
      {
        "token_a": "shey",
        "token_b": "qokain",
        "observed": 18,
        "expected": 2.64,
        "ratio": 6.82,
        "chi2": 89.42,
        "p_value": 0.0,
        "role_a": "ENERGY_OPERATOR",
        "role_b": "ENERGY_OPERATOR",
        "class_a": 31,
        "class_b": 33,
        "same_role": true,
        "same_class": false
      },
      {
        "token_a": "qotal",
        "token_b": "shedy",
        "observed": 8,
        "expected": 1.19,
        "ratio": 6.75,
        "chi2": 39.15,
        "p_value": 3.9237668669755976e-10,
        "role_a": "ENERGY_OPERATOR",
        "role_b": "ENERGY_OPERATOR",
        "class_a": 36,
        "class_b": 8,
        "same_role": true,
        "same_class": false
      },
      {
        "token_a": "okar",
        "token_b": "ar",
        "observed": 8,
        "expected": 1.22,
        "ratio": 6.54,
        "chi2": 37.52,
        "p_value": 9.035847625682436e-10,
        "role_a": "FREQUENT_OPERATOR",
        "role_b": "FLOW_OPERATOR",
        "class_a": 14,
        "class_b": 7,
        "same_role": false,
        "same_class": false
      },
      {
        "token_a": "otar",
        "token_b": "ar",
        "observed": 8,
        "expected": 1.24,
        "ratio": 6.45,
        "chi2": 36.86,
        "p_value": 1.2695426931941256e-09,
        "role_a": "FREQUENT_OPERATOR",
        "role_b": "FLOW_OPERATOR",
        "class_a": 14,
        "class_b": 7,
        "same_role": false,
        "same_class": false
      },
      {
        "token_a": "ar",
        "token_b": "aiin",
        "observed": 23,
        "expected": 3.65,
        "ratio": 6.3,
        "chi2": 102.53,
        "p_value": 0.0,
        "role_a": "FLOW_OPERATOR",
        "role_b": "FREQUENT_OPERATOR",
        "class_a": 7,
        "class_b": 9,
        "same_role": false,
        "same_class": false
      }
    ]
  },
  "forbidden": {
    "count": 9,
    "role_expected_count": 7,
    "token_specific_count": 2,
    "role_expected": [
      {
        "token_a": "chedy",
        "token_b": "aiin",
        "expected": 7.64,
        "role_a": "ENERGY_OPERATOR",
        "role_b": "FREQUENT_OPERATOR",
        "class_a": 8,
        "class_b": 9
      },
      {
        "token_a": "shedy",
        "token_b": "aiin",
        "expected": 6.7,
        "role_a": "ENERGY_OPERATOR",
        "role_b": "FREQUENT_OPERATOR",
        "class_a": 8,
        "class_b": 9
      },
      {
        "token_a": "qokeedy",
        "token_b": "ol",
        "expected": 6.54,
        "role_a": "ENERGY_OPERATOR",
        "role_b": "CORE_CONTROL",
        "class_a": 33,
        "class_b": 11
      },
      {
        "token_a": "chedy",
        "token_b": "ar",
        "expected": 5.52,
        "role_a": "ENERGY_OPERATOR",
        "role_b": "FLOW_OPERATOR",
        "class_a": 8,
        "class_b": 7
      },
      {
        "token_a": "ol",
        "token_b": "qokain",
        "expected": 5.43,
        "role_a": "CORE_CONTROL",
        "role_b": "ENERGY_OPERATOR",
        "class_a": 11,
        "class_b": 33
      },
      {
        "token_a": "ol",
        "token_b": "qokedy",
        "expected": 5.29,
        "role_a": "CORE_CONTROL",
        "role_b": "ENERGY_OPERATOR",
        "class_a": 11,
        "class_b": 33
      },
      {
        "token_a": "qokeedy",
        "token_b": "aiin",
        "expected": 5.05,
        "role_a": "ENERGY_OPERATOR",
        "role_b": "FREQUENT_OPERATOR",
        "class_a": 33,
        "class_b": 9
      }
    ],
    "token_specific": [
      {
        "token_a": "chey",
        "token_b": "chedy",
        "expected": 6.37,
        "role_a": "ENERGY_OPERATOR",
        "role_b": "ENERGY_OPERATOR",
        "class_a": 31,
        "class_b": 8,
        "same_class": false
      },
      {
        "token_a": "chey",
        "token_b": "shedy",
        "expected": 5.31,
        "role_a": "ENERGY_OPERATOR",
        "role_b": "ENERGY_OPERATOR",
        "class_a": 31,
        "class_b": 8,
        "same_class": false
      }
    ]
  },
  "validation": {
    "or_aiin_found": true,
    "or_aiin_details": {
      "observed": 42,
      "expected": 3.76,
      "ratio": 11.16,
      "chi2": 388.58
    },
    "constraint": "C561"
  },
  "shuffle": {
    "n_shuffles": 1000,
    "seed": 42,
    "real_forbidden_count": 9,
    "shuffle_surviving_mean": 0.27,
    "shuffle_surviving_std": 0.49,
    "shuffle_total_forbidden_mean": 0.64,
    "shuffle_total_forbidden_std": 0.75,
    "p_value": 0.0
  },
  "verdict": "PASS"
}